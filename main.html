<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Setup</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="main_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_files/libs/quarto-html/quarto.js"></script>
<script src="main_files/libs/quarto-html/popper.min.js"></script>
<script src="main_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Setup</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_squared_error</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> handlers <span class="im">import</span> DataHandler</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> news_api <span class="im">import</span> NewsAPI</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> useconomyapi <span class="im">import</span> USEconomyAPI</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> seekingalpha <span class="im">import</span> SeekingAlphaNewsAPI</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> visualizations <span class="im">import</span> Visualizations</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cryptopanic <span class="im">import</span> CryptoPanicAPI</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cryptonewsapi <span class="im">import</span> CryptoNewsAPI</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> coinrankingapi <span class="im">import</span> CryptoDataFetcher</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sentiment <span class="im">import</span> SentimentAnalyzer</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>hd <span class="op">=</span> DataHandler()</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>vz <span class="op">=</span> Visualizations()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\tqdm\auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>True</code></pre>
</div>
</div>
<div id="cell-3" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for testing set from_date and time_period based on what you want to show</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>from_date <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> from_date <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    time_period <span class="op">=</span> <span class="st">'30d'</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> from_date <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    time_period <span class="op">=</span> <span class="st">'24h'</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"wrong input"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="get-news-articles" class="level1">
<h1>Get News Articles</h1>
<section id="getting-past-month-news" class="level2">
<h2 class="anchored" data-anchor-id="getting-past-month-news">Getting Past Month News</h2>
<p>This code is designed to fetch and process news articles about cryptocurrency from various sources over the past 30 days. It uses three APIs: NewsAPI, USEconomyAPI, and SeekingAlphaNewsAPI. Initially, it retrieves news from NewsAPI within the specified date range and standardizes the date format. If articles are found, it proceeds to fetch news from the USEconomyAPI, converting dates to Unix timestamps for the query. Then, it fetches additional news from SeekingAlphaNewsAPI for the same date range. The data from all three sources are combined into a single DataFrame, and duplicate headlines are processed to ensure uniqueness. Finally, the merged data is prepared for further use or analysis.</p>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>from_date <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance of the NewsAPI</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>news_api <span class="op">=</span> NewsAPI(api_key<span class="op">=</span>os.getenv(<span class="st">'news_api'</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch news articles about Crypto from a specific date range</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> news_api.get_news(topic<span class="op">=</span><span class="st">'crypto'</span>, from_date<span class="op">=</span>hd.get_date_str(from_date), to_date<span class="op">=</span>(hd.get_date_str(<span class="dv">0</span>)))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> hd.standardize_date_format(df, <span class="st">'date'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the DataFrame is not empty</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the headlines along with the date and description</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> news found"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No articles found for the given topic and date range."</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> USEconomyAPI(os.getenv(<span class="st">'useconomyapi'</span>))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>starting_date <span class="op">=</span> hd.convert_to_unix_ms(hd.get_date_dt(from_date))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>ending_date <span class="op">=</span> hd.convert_to_unix_ms(hd.get_date_dt(<span class="dv">0</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>crypto_news_df_2 <span class="op">=</span> api.fetch_news(category<span class="op">=</span><span class="st">'economy'</span>, initial<span class="op">=</span>starting_date, final<span class="op">=</span>ending_date )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>crypto_news_df_2 <span class="op">=</span> api.format_news_data(crypto_news_df_2)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>api_key <span class="op">=</span> os.getenv(<span class="st">'seeking_alpha'</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>seeking_alpha_api <span class="op">=</span> SeekingAlphaNewsAPI(api_key)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>category <span class="op">=</span> <span class="st">'crypto'</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>crypto_news_df_3 <span class="op">=</span> seeking_alpha_api.fetch_news_by_days(from_date, category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="getting-daily-news" class="level2">
<h2 class="anchored" data-anchor-id="getting-daily-news">Getting Daily News</h2>
<p>This code fetches daily news articles about cryptocurrency from multiple sources and processes the data to remove duplicates. It initializes the CryptoPanicAPI with an authentication token and fetches “hot” public news posts. The fetched data is formatted into a DataFrame. Next, it uses CryptoNewsAPI to gather news from specific sources like Coindesk and Cointelegraph, formatting and appending the data to a list. If the list is not empty, the data is concatenated into a single DataFrame. The code then fetches and formats additional news from USEconomyAPI and SeekingAlphaNewsAPI for the same date range. All gathered data is merged into a single DataFrame, and duplicates are processed to ensure uniqueness. The final DataFrame contains a comprehensive set of cryptocurrency news for the day, ready for further use or analysis.</p>
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>from_date <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>auth_token <span class="op">=</span> os.getenv(<span class="st">'cryptopanic'</span>)  <span class="co"># Example token</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>crypto_panic_api <span class="op">=</span> CryptoPanicAPI(auth_token)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>filters <span class="op">=</span> {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'public'</span>: <span class="st">'true'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'filter'</span>: <span class="st">'hot'</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'currencies'</span>: <span class="va">None</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> crypto_panic_api.format_news_data(crypto_panic_api.fetch_news(filters))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>api_key <span class="op">=</span> os.getenv(<span class="st">'cryptonewsapi'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>crypto_news_api <span class="op">=</span> CryptoNewsAPI(api_key)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>sources <span class="op">=</span> [<span class="st">'coindesk'</span>, <span class="st">'cointelegraph'</span>, <span class="st">'bitcoinist'</span>, <span class="st">'decrypt'</span>, <span class="st">'bsc'</span>, <span class="st">'theguardian'</span>]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>all_news <span class="op">=</span> []  <span class="co"># List to store data from each source</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> source <span class="kw">in</span> sources:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    news_data <span class="op">=</span> crypto_news_api.fetch_news(source) </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> news_data:  <span class="co"># Ensure there is data before formatting</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        formatted_data <span class="op">=</span> crypto_news_api.format_news_data(news_data)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> formatted_data.empty:</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            all_news.append(formatted_data)  <span class="co"># Append the formatted DataFrame to the list</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate all dataframes if all_news is not empty</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> all_news:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    df_daily_news_2 <span class="op">=</span> pd.concat(all_news)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.concat([df,df_daily_news_2])</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> USEconomyAPI(os.getenv(<span class="st">'useconomyapi'</span>))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>starting_date <span class="op">=</span> hd.convert_to_unix_ms(hd.get_date_dt(from_date))</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>ending_date <span class="op">=</span> hd.convert_to_unix_ms(hd.get_date_dt(<span class="dv">0</span>))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>crypto_news_df_2 <span class="op">=</span> api.fetch_news(category<span class="op">=</span><span class="st">'economy'</span>, initial<span class="op">=</span>starting_date, final<span class="op">=</span>ending_date )</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>crypto_news_df_2 <span class="op">=</span> api.format_news_data(crypto_news_df_2)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>api_key <span class="op">=</span> os.getenv(<span class="st">'seeking_alpha'</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>seeking_alpha_api <span class="op">=</span> SeekingAlphaNewsAPI(api_key)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>crypto_news_df_3 <span class="op">=</span> seeking_alpha_api.fetch_news_by_days(from_date, <span class="st">'crypto'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="process-data" class="level2">
<h2 class="anchored" data-anchor-id="process-data">Process Data</h2>
<p>Here we concatenate the news dataset from the various APIs and process the duplicates.</p>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for testing purposes Load data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#crypto_news_df = pd.read_csv('data/crypto_30d_news.csv')</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#crypto_news_df_2 = pd.read_csv('data/crypto_30d_news_2.csv')</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#us_economy_news = pd.read_csv('data/us_economy_30d_news.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the dataframes</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df, crypto_news_df_2, crypto_news_df_3])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>hd.process_duplicates(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicate Entries: 0</code></pre>
</div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for testing purposes</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="ss">f'data/</span><span class="sc">{</span>from_date<span class="sc">}</span><span class="ss">d_news.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="get-crypto-information" class="level1">
<h1>Get Crypto Information</h1>
<p>This code fetches historical price data for meme category cryptocurrencies over the past 30 days or 24 hours, based on the value of from_date. It initializes a CryptoDataFetcher with the appropriate API key and time period, then retrieves the price history for relevant cryptocurrencies using the Coinranking API. If data is successfully fetched, it writes the data to a CSV file. The DataHandler class, also included in the code, provides utility functions for handling dates and processing duplicates, though it is not directly used in the main workflow of this script. The CryptoDataFetcher class contains methods for sending API requests, fetching coin UUIDs based on tags, retrieving historical price data, and writing the results to a CSV file.</p>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>category <span class="op">=</span> <span class="st">'meme'</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>api_key <span class="op">=</span> os.getenv(<span class="st">'coinranking'</span>) </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> from_date <span class="op">==</span> <span class="dv">30</span>:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    time_period <span class="op">=</span> <span class="st">'30d'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    time_period <span class="op">=</span> <span class="st">'24h'</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>fetcher <span class="op">=</span> CryptoDataFetcher(api_key, default_tags<span class="op">=</span>category, default_limit<span class="op">=</span><span class="dv">50</span>, default_time_period<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>time_period<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>price_data <span class="op">=</span> fetcher.fetch_all_history()</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> price_data.empty:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    fetcher.write_to_csv(price_data, <span class="ss">f'data/</span><span class="sc">{</span>time_period<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>fetcher<span class="sc">.</span>default_limit<span class="sc">}{</span>category<span class="sc">}</span><span class="ss">_history.csv'</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No data fetched."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for testing purposes</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="ss">f'data/</span><span class="sc">{</span>time_period<span class="sc">}</span><span class="ss">_news.csv'</span>, index<span class="op">=</span><span class="va">False</span>) <span class="co">#for testing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sentiment" class="level1">
<h1>Sentiment</h1>
<section id="apply-finbert" class="level2">
<h2 class="anchored" data-anchor-id="apply-finbert">Apply Finbert</h2>
<p>This code performs sentiment analysis on a DataFrame of text data using a pretrained BERT model. It initializes a SentimentAnalyzer class that uses the ProsusAI/finbert model for financial sentiment analysis. The predict_sentiment_batch method processes text in batches, tokenizes the input texts, and uses the model to predict sentiment scores, utilizing GPU if available. The <code>add_sentiments_to_df</code> method adds these sentiment scores as a new column in the input DataFrame. Finally, the script demonstrates using this functionality to add sentiment data to an existing DataFrame and display the first few rows of the augmented DataFrame.</p>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for testing purposes</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#df = pd.read_csv("data/30d_news.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize SentimentAnalyzer</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> SentimentAnalyzer()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sentiment_data <span class="op">=</span> analyzer.add_sentiments_to_df(df)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sentiment_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for testing purposes</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="ss">f'data/</span><span class="sc">{</span>time_period<span class="sc">}</span><span class="ss">_news_with_sentiment.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="vizualisations" class="level1">
<h1>Vizualisations</h1>
<p>This code visualizes the relationship between cryptocurrency prices and sentiment data. It uses a Visualizations class to process and plot the data. Initially, it averages sentiment scores over specified time periods and normalizes and aggregates cryptocurrency price data across different coins. The plot_normalized_price_and_sentiment method creates a plot showing normalized prices and smoothed sentiment scores over time. The analysis method performs correlation analysis between sentiment and future price changes, plotting the results and calculating statistical measures like correlation coefficients, R-squared values, and AIC. This analysis is visualized through scatter plots and regression lines, highlighting the predictive power of sentiment on price changes. Additionally, plot_for_web and analysis_for_web methods generate similar visualizations optimized for web embedding, returning results as SVG strings. This comprehensive visualization and analysis framework helps to understand how sentiment affects cryptocurrency prices.</p>
<section id="average-sentiment-per-day-and-normalize-price" class="level2">
<h2 class="anchored" data-anchor-id="average-sentiment-per-day-and-normalize-price">Average Sentiment per Day and Normalize Price</h2>
<div id="cell-29" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for testing purposes</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> from_date <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> from_date <span class="op">==</span> <span class="dv">30</span>:</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    sentiment_data <span class="op">=</span> pd.read_csv(<span class="ss">f"data/30d_news_with_sentiment.csv"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    price_data <span class="op">=</span> pd.read_csv(<span class="st">'data/30d_50meme_history.csv'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> from_date <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    sentiment_data <span class="op">=</span> pd.read_csv(<span class="ss">f"data/24h_news_with_sentiment.csv"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    price_data <span class="op">=</span> pd.read_csv(<span class="st">'data/24h_50meme_history.csv'</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"from_date should be either 1 (daily) or 30 (monthly)."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sentiment_data <span class="op">=</span> vz.average_sentiment_per_time(from_date,sentiment_data)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>price_data <span class="op">=</span> vz.normalize_and_aggregate_prices(price_data)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> vz.plot_normalized_price_and_sentiment(price_data, sentiment_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sentiment_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">average sentiment</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-05 10:00:00</td>
<td>0.219927</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-05 15:00:00</td>
<td>0.783000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-05 17:00:00</td>
<td>0.029471</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-08 07:00:00</td>
<td>0.514828</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-08 15:00:00</td>
<td>0.383531</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>price_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">normalized price</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-05 08:00:00</td>
<td>0.018751</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-05 09:00:00</td>
<td>0.018704</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-05 10:00:00</td>
<td>0.018592</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-05 11:00:00</td>
<td>0.018534</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-05 12:00:00</td>
<td>0.018380</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
</section>
<section id="analysis-1d" class="level1">
<h1>Analysis 1d</h1>
<p>This code processes and combines cryptocurrency price data with sentiment data to facilitate time-series analysis. It starts by calculating the percentage price change from normalized prices and handling any NaN values by replacing them with zero. The price data is then resampled to 5-minute intervals, using forward filling to propagate the last known prices and changes. The sentiment data timestamps are rounded to the nearest 5 minutes to align with the price data intervals.</p>
<p>The code uses the merge_asof function to merge the sentiment data with the nearest corresponding price data, ensuring alignment based on time. To prepare for predictive analysis, it shifts the ‘price_change’ column by -1 to represent the next 5-minute price change. The combined data is then cleaned up by renaming columns to match expected function inputs and dropping unnecessary columns, resulting in a DataFrame that combines sentiment and future price change data, ready for further analysis.</p>
<div id="cell-35" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage price change directly from normalized prices</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>price_data[<span class="st">'price_change'</span>] <span class="op">=</span> price_data[<span class="st">'normalized price'</span>].pct_change() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>price_data[<span class="st">'price_change'</span>] <span class="op">=</span> price_data[<span class="st">'price_change'</span>].fillna(<span class="dv">0</span>)  <span class="co"># Replace NaN values with 0</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample price data to 5-minute intervals, forward filling the last known prices and changes</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>price_data_resampled <span class="op">=</span> price_data.resample(<span class="st">'5min'</span>).last().ffill()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Round sentiment data timestamps to the nearest 5 minutes</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>sentiment_data.index <span class="op">=</span> sentiment_data.index.<span class="bu">round</span>(<span class="st">'5min'</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge using merge_asof to align sentiment data with the nearest price data</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>combined_data <span class="op">=</span> pd.merge_asof(sentiment_data.sort_index(), price_data_resampled.reset_index(), </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                              left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">'timestamp'</span>, direction<span class="op">=</span><span class="st">'forward'</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Since we need the next period's price change, shift the 'price_change' column by -1</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>combined_data[<span class="st">'Next 5min Price Change'</span>] <span class="op">=</span> combined_data[<span class="st">'price_change'</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns to match function expectations</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>combined_data.rename(columns<span class="op">=</span>{<span class="st">'Average Sentiment'</span>: <span class="st">'Average Sentiment'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the 'timestamp' and original 'price_change' columns if not needed</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>combined_data.drop(columns<span class="op">=</span>[<span class="st">'timestamp'</span>, <span class="st">'price_change'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>combined_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">average sentiment</th>
<th data-quarto-table-cell-role="th">normalized price</th>
<th data-quarto-table-cell-role="th">Next 5min Price Change</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-05 10:00:00</td>
<td>0.219927</td>
<td>0.018592</td>
<td>0.962161</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-05 15:00:00</td>
<td>0.783000</td>
<td>0.018758</td>
<td>0.335842</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-05 17:00:00</td>
<td>0.029471</td>
<td>0.018813</td>
<td>-0.007174</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-08 07:00:00</td>
<td>0.514828</td>
<td>0.018985</td>
<td>-0.187314</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-08 15:00:00</td>
<td>0.383531</td>
<td>0.020179</td>
<td>-0.616799</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>This code uses the Visualizations class to analyze the relationship between cryptocurrency price changes and sentiment data over different time periods. The analysis method is invoked with combined data and a specified date range (from_date). Depending on the from_date value (1 for daily or 30 for monthly), it sets the time intervals and lags for analysis.</p>
<p>For each specified lag, the method:</p>
<ol type="1">
<li>Shifts the sentiment data by the lag value to create a “Lagged Sentiment” column.</li>
<li>Calculates the correlation between lagged sentiment and the next period’s price change.</li>
<li>Plots scatter plots showing the relationship between lagged sentiment and future price changes.</li>
<li>Computes and prints statistical metrics, including average price changes for high and low sentiment, correlation coefficients, R-squared values, and AIC.</li>
</ol>
<p>The method also performs linear regression analysis to determine the predictive power of sentiment on price changes. If from_date is 30, it additionally resamples the data for longer-term analysis. The results are visualized using scatter plots with regression lines, and a summary of correlations is displayed using a bar plot. This comprehensive analysis helps in understanding how sentiment impacts cryptocurrency prices over different time lags.</p>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>vz.analysis(combined_data, from_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analysis-30d" class="level1">
<h1>Analysis 30d</h1>
<p>To address how the price change is calculated and ensure accuracy, let’s clarify the method. The price change between two days is typically calculated using the formula:</p>
<p>Price Change (%) = ((Current Day Price−Previous Day Price) / Previous Day Price ) × 100</p>
<p>This formula captures the percentage change from one day to the next, which is ideal for analyzing how daily variations in price relate to other factors like sentiment.</p>
<p>Analyse how the variable Average Sentiment of a day influence the variable Price change.</p>
<div id="cell-41" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the closing price for each day (last price of the day)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>price_data_daily <span class="op">=</span> price_data[<span class="st">'normalized price'</span>].resample(<span class="st">'D'</span>).last()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the daily price change percentage</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>price_data_daily <span class="op">=</span> pd.DataFrame(price_data_daily)  <span class="co"># Ensure it's a DataFrame for the next operations</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>price_data_daily[<span class="st">'Price Change'</span>] <span class="op">=</span> price_data_daily[<span class="st">'normalized price'</span>].pct_change() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Shift the price change to align with the day's sentiment to measure its influence on the next day's price change</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>price_data_daily[<span class="st">'Price Change'</span>] <span class="op">=</span> price_data_daily[<span class="st">'Price Change'</span>].shift(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Since sentiment is often recorded multiple times a day, we'll average it for daily granularity</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>sentiment_data_daily <span class="op">=</span> pd.DataFrame(sentiment_data[<span class="st">'average sentiment'</span>].resample(<span class="st">'D'</span>).mean())</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the two datasets on the date index</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>combined_data <span class="op">=</span> pd.concat([price_data_daily, sentiment_data_daily], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>combined_data.columns <span class="op">=</span> [<span class="st">'Normalized Price'</span>, <span class="st">'Next Day Price Change'</span>, <span class="st">'average sentiment'</span>]</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>combined_data.dropna(inplace<span class="op">=</span><span class="va">True</span>)  <span class="co"># Drop rows with NaN values that might result from resampling, shifting, or non-overlapping dates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="lag-analysis" class="level3">
<h3 class="anchored" data-anchor-id="lag-analysis">Lag Analysis</h3>
<p>Shift the sentiment data by various time periods (both forward and backward) to see if the correlation improves when assuming a delayed effect of sentiment on prices. Experiment with different lags between sentiment data and price data. Often, market reactions to news or events are not immediate. Analyzing the effect of sentiment over different time lags (e.g., 1 day, 2 days, 1 week) might reveal stronger correlations.</p>
<ul>
<li><strong>Lagging Sentiment Data Backward (Negative Lag)</strong> Concept: When we lag sentiment data backward (using a negative lag), we are effectively shifting sentiment data to later dates. This method is used when you suspect that sentiment influences future price changes. For example, if we use a lag of -1 day, the sentiment data from January 1st is aligned with the price change of January 2nd. This is based on the hypothesis that today’s sentiment will affect tomorrow’s price changes. This approach is suitable if we are testing the hypothesis that the market reacts to sentiment after a delay. It helps to identify if changes in sentiment can predict subsequent movements in prices.</li>
<li><strong>Lagging Sentiment Data Forward (Positive Lag)</strong> Concept: Lagging sentiment data forward (using a positive lag) means we shift sentiment data to earlier dates. This scenario is used to examine if past sentiment changes are reflected in current or future price changes. For instance, if we set a lag of +1 day, the sentiment from January 2nd is used in conjunction with the price change of January 1st. This might seem counterintuitive at first, as it suggests looking at how previous price changes correlate with future sentiment but can be insightful for retrospective analyses, such as studying whether price changes lead to a detectable shift in sentiment, perhaps due to investor reactions or feedback loops in market behavior.</li>
</ul>
<section id="procedure" class="level4">
<h4 class="anchored" data-anchor-id="procedure">Procedure</h4>
<ul>
<li><strong>Plotting Correlation</strong> Plotting sentiment against price change can help visually identify patterns or trends, such as whether lower sentiments tend to coincide with negative price changes.</li>
<li><strong>Descriptive Statistics</strong> Compute and compare averages or percent changes across different conditions. For example, comparing average price changes on days with particularly high or low sentiments.</li>
<li><strong>Daily Regression Analysis</strong> We could use regression techniques to see how changes in sentiment predict changes in price.</li>
<li><strong>Weekly Regression Analysis</strong> As daily correlation might not provide the best results, we could use regression techniques over a period (e.g., weekly, monthly) to see how changes in sentiment predict changes in price.</li>
</ul>
<div id="cell-45" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Analysis</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>model_type <span class="op">=</span> <span class="st">'linear'</span>  <span class="co"># or 'rf'</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>future_predictions_by_lag <span class="op">=</span> vz.analysis(combined_data, from_date, model_type<span class="op">=</span>model_type, for_web<span class="op">=</span><span class="va">False</span>, predict_days<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation with -7 Day(s) lag: 0.12
Linear Model R-squared: 0.02
Linear Model RMSE: 6.69

Average Price Change on High Sentiment Days: -124 %
Average Price Change on Low Sentiment Days: -78 %
Correlation with -2 Day(s) lag: 0.48
Linear Model R-squared: 0.23
Linear Model RMSE: 5.37

Average Price Change on High Sentiment Days: -136 %
Average Price Change on Low Sentiment Days: -53 %
Correlation with -1 Day(s) lag: -0.03
Linear Model R-squared: 0.0
Linear Model RMSE: 6.05

Average Price Change on High Sentiment Days: -136 %
Average Price Change on Low Sentiment Days: -29 %
Correlation with 0 Day(s) lag: -0.1
Linear Model R-squared: 0.01
Linear Model RMSE: 5.91

Average Price Change on High Sentiment Days: -106 %
Average Price Change on Low Sentiment Days: -45 %
Correlation with 1 Day(s) lag: 0.19
Linear Model R-squared: 0.04
Linear Model RMSE: 5.93

Average Price Change on High Sentiment Days: -129 %
Average Price Change on Low Sentiment Days: -45 %
Correlation with 2 Day(s) lag: 0.02
Linear Model R-squared: 0.0
Linear Model RMSE: 6.12

Average Price Change on High Sentiment Days: -141 %
Average Price Change on Low Sentiment Days: -4 %
Correlation with 7 Day(s) lag: -0.15
Linear Model R-squared: 0.02
Linear Model RMSE: 4.62

Average Price Change on High Sentiment Days: -137 %
Average Price Change on Low Sentiment Days: 118 %</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-21-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect all predictions from each lag</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>all_predictions <span class="op">=</span> []</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze every prediction of every lag and collect them</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, future_predictions <span class="kw">in</span> <span class="bu">enumerate</span>(future_predictions_by_lag):</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(future_predictions, (<span class="bu">list</span>, np.ndarray)):</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        future_predictions <span class="op">=</span> [future_predictions]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out NaN values</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    future_predictions <span class="op">=</span> [pred <span class="cf">for</span> pred <span class="kw">in</span> future_predictions <span class="cf">if</span> <span class="kw">not</span> np.isnan(pred)]</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    all_predictions.extend(future_predictions)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    avg_prediction <span class="op">=</span> <span class="bu">round</span>(np.mean(future_predictions), <span class="dv">2</span>) <span class="cf">if</span> future_predictions <span class="cf">else</span> <span class="st">'N/A'</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Average Prediction for lag </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>avg_prediction<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out NaN values from all_predictions</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>all_predictions <span class="op">=</span> [pred <span class="cf">for</span> pred <span class="kw">in</span> all_predictions <span class="cf">if</span> <span class="kw">not</span> np.isnan(pred)]</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the overall average prediction</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>overall_avg_prediction <span class="op">=</span> <span class="bu">round</span>(np.mean(all_predictions), <span class="dv">2</span>) <span class="cf">if</span> all_predictions <span class="cf">else</span> <span class="st">'N/A'</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Overall Average Prediction across all lags: </span><span class="sc">{</span>overall_avg_prediction<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Prediction for lag 0: N/A
Average Prediction for lag 1: -1.78
Average Prediction for lag 2: -0.75
Average Prediction for lag 3: -0.62
Average Prediction for lag 4: -1.03
Average Prediction for lag 5: -0.74
Average Prediction for lag 6: N/A
Overall Average Prediction across all lags: -0.98</code></pre>
</div>
</div>
<p>After observing suboptimal results from the previous linear regression model, we decided to employ a random forest model to leverage its strengths in capturing complex, non-linear relationships between sentiment and cryptocurrency price changes. The choice of n_estimators=1000 was made to ensure a robust and stable model by averaging the results of a large number of decision trees, which helps to reduce overfitting and improve predictive accuracy. The specific value of 1000 strikes a balance between achieving these benefits and managing computational efficiency. We set random_state=42 to ensure reproducibility of our results, facilitating consistent evaluation and debugging. No other hyperparameters were tuned at this stage to maintain simplicity and focus on the primary adjustments. Further tuning can be explored if the model’s performance needs additional improvements after initial evaluation.</p>
<div id="cell-48" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Analysis</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>model_type <span class="op">=</span> <span class="st">'rf'</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>future_predictions_by_lag <span class="op">=</span> vz.analysis(combined_data, from_date, model_type<span class="op">=</span>model_type, for_web<span class="op">=</span><span class="va">False</span>, predict_days<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\visualizations.py:176: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  future_sentiment = combined_data['average sentiment'].tail(predict_days).shift(lag).fillna(method='ffill')
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\sklearn\base.py:493: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
  warnings.warn(
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\visualizations.py:176: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  future_sentiment = combined_data['average sentiment'].tail(predict_days).shift(lag).fillna(method='ffill')
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\sklearn\base.py:493: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
  warnings.warn(
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\visualizations.py:176: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  future_sentiment = combined_data['average sentiment'].tail(predict_days).shift(lag).fillna(method='ffill')
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\sklearn\base.py:493: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
  warnings.warn(
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\visualizations.py:176: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  future_sentiment = combined_data['average sentiment'].tail(predict_days).shift(lag).fillna(method='ffill')
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\sklearn\base.py:493: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
  warnings.warn(
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\visualizations.py:176: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  future_sentiment = combined_data['average sentiment'].tail(predict_days).shift(lag).fillna(method='ffill')
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\sklearn\base.py:493: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
  warnings.warn(
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\visualizations.py:176: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  future_sentiment = combined_data['average sentiment'].tail(predict_days).shift(lag).fillna(method='ffill')
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\sklearn\base.py:493: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
  warnings.warn(
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\visualizations.py:176: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  future_sentiment = combined_data['average sentiment'].tail(predict_days).shift(lag).fillna(method='ffill')
c:\Users\UrsHu\Pillars\Learn\Academic\Master\Semestre 2\data analysis\crypto-sentiment-tracker\venv\Lib\site-packages\sklearn\base.py:493: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation with -7 Day(s) lag: 0.12
Rf Model R-squared: 0.81
Rf Model RMSE: 2.94

Average Price Change on High Sentiment Days: -124 %
Average Price Change on Low Sentiment Days: -78 %
Correlation with -2 Day(s) lag: 0.48
Rf Model R-squared: 0.79
Rf Model RMSE: 2.79

Average Price Change on High Sentiment Days: -136 %
Average Price Change on Low Sentiment Days: -53 %
Correlation with -1 Day(s) lag: -0.03
Rf Model R-squared: 0.75
Rf Model RMSE: 3.02

Average Price Change on High Sentiment Days: -136 %
Average Price Change on Low Sentiment Days: -29 %
Correlation with 0 Day(s) lag: -0.1
Rf Model R-squared: 0.83
Rf Model RMSE: 2.46

Average Price Change on High Sentiment Days: -106 %
Average Price Change on Low Sentiment Days: -45 %
Correlation with 1 Day(s) lag: 0.19
Rf Model R-squared: 0.81
Rf Model RMSE: 2.62

Average Price Change on High Sentiment Days: -129 %
Average Price Change on Low Sentiment Days: -45 %
Correlation with 2 Day(s) lag: 0.02
Rf Model R-squared: 0.78
Rf Model RMSE: 2.89

Average Price Change on High Sentiment Days: -141 %
Average Price Change on Low Sentiment Days: -4 %
Correlation with 7 Day(s) lag: -0.15
Rf Model R-squared: 0.86
Rf Model RMSE: 1.78

Average Price Change on High Sentiment Days: -137 %
Average Price Change on Low Sentiment Days: 118 %</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-23-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect all predictions from each lag</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>all_predictions <span class="op">=</span> []</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze every prediction of every lag and collect them</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, future_predictions <span class="kw">in</span> <span class="bu">enumerate</span>(future_predictions_by_lag):</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(future_predictions, (<span class="bu">list</span>, np.ndarray)):</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        future_predictions <span class="op">=</span> [future_predictions]</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out NaN values</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    future_predictions <span class="op">=</span> [pred <span class="cf">for</span> pred <span class="kw">in</span> future_predictions <span class="cf">if</span> <span class="kw">not</span> np.isnan(pred)]</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    all_predictions.extend(future_predictions)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    avg_prediction <span class="op">=</span> <span class="bu">round</span>(np.mean(future_predictions), <span class="dv">2</span>) <span class="cf">if</span> future_predictions <span class="cf">else</span> <span class="st">'N/A'</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Average Prediction for lag </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>avg_prediction<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out NaN values from all_predictions</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>all_predictions <span class="op">=</span> [pred <span class="cf">for</span> pred <span class="kw">in</span> all_predictions <span class="cf">if</span> <span class="kw">not</span> np.isnan(pred)]</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the overall average prediction</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>overall_avg_prediction <span class="op">=</span> <span class="bu">round</span>(np.mean(all_predictions), <span class="dv">2</span>) <span class="cf">if</span> all_predictions <span class="cf">else</span> <span class="st">'N/A'</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Overall Average Prediction across all lags: </span><span class="sc">{</span>overall_avg_prediction<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Prediction for lag 0: -2.48
Average Prediction for lag 1: -0.07
Average Prediction for lag 2: -0.37
Average Prediction for lag 3: -0.84
Average Prediction for lag 4: 0.39
Average Prediction for lag 5: -0.13
Average Prediction for lag 6: -0.95
Overall Average Prediction across all lags: -0.64</code></pre>
</div>
</div>
</section>
</section>
<section id="enhancement" class="level3">
<h3 class="anchored" data-anchor-id="enhancement">Enhancement</h3>
<ol type="1">
<li>Volatility and Outliers: If either the price data or the sentiment data is more volatile or has outliers, it can skew the correlation. For example, a few large jumps or drops in price might not be directly linked to sentiment but could still heavily influence the correlation calculation.</li>
<li>Noise in Data: The sentiment scores might contain noise due to the inherent subjectivity and complexity of natural language processing. This noise can dilute real correlations with price movements.</li>
<li>Non-linear Relationships: The relationship between sentiment and prices might be non-linear, meaning that while they do move together, the relationship might not be directly proportional or consistent across the whole range of data.</li>
<li>Averaging and Smoothing: Both the averaging of sentiment over time and the smoothing could be masking more nuanced interactions between individual spikes in sentiment and corresponding price changes.</li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>